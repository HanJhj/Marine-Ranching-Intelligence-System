{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>海洋牧场可视化系统</title>
    <link href="{% static 'MainInformation/css/common.css' %}" rel="stylesheet" type="text/css">
    <script src="{% static 'MainInformation/js/Plugin/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'MainInformation/js/Plugin/echarts.min.js' %}"></script>
    <script src="{% static 'MainInformation/js/Plugin/bmap.min.js' %}"></script>
    <script src="{% static 'MainInformation/js/common.js' %}"></script>
    <script src="{% static 'MainInformation/js/NCDindex.js' %}"></script>
    <script src="{% static 'MainInformation/js/echarts.js'%}"></script>
    
</head>
<body>

<!--顶部-->
<header class="header left">
    <div class="left nav">
        <ul>
            <li class="nav_active"><i class="nav_1"></i><a href="{% url 'MainInformation' %}">主要信息</a></li>
            <li><i class="nav_2"></i><a href="{% url 'UnderWater' %}">水下系统</a></li>
            <li><i class="nav_3"></i><a href="{% url 'DataCenter' %}">数据中心</a></li>
            <li><i class="nav_4"></i><a href="{% url 'SmartCenter' %}">智能中心</a></li>
            <li><i class="nav_5"></i><a href="{% url 'BackManage' %}">管理中心</a></li>
          </ul>
    </div>
    <div class="header_center left" style="position:relative">
        <h2><strong>海 洋 牧 场 可 视 化 系 统</strong></h2>

    </div>
    <div class="right showTime text_right"></div>

<script>
function updateTime() {
    var dt = new Date();  
    var y = dt.getFullYear();  
    var mt = dt.getMonth() + 1;  
    var day = dt.getDate();  
    var h = dt.getHours(); // 获取时  
    var m = dt.getMinutes(); // 获取分  
    var s = dt.getSeconds(); // 获取秒  

    // 为了确保月份、日期、小时、分钟和秒都是两位数  
    mt = mt < 10 ? '0' + mt : mt;  
    day = day < 10 ? '0' + day : day;  
    h = h < 10 ? '0' + h : h;  
    m = m < 10 ? '0' + m : m;  
    s = s < 10 ? '0' + s : s;  

    // 更新显示时间  
    document.querySelector(".showTime").innerHTML =  
        "日期：" +  
        y +  
        "年" +  
        mt +  
        "月" +  
        day +  
        "日" +
        "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+  
        "时间：" +  
        h +  
        "时" +  
        m +  
        "分" +  
        s +  
        "秒";  
}

// 立即显示时间
updateTime();

// 设定定时器，循环运行  
setInterval(updateTime, 1000);
</script>



</header>



<!--内容部分-->
<div class="con left">
    <div class="div_any">
        <!--监控视频-->
        <div class="div_any04 left ">
            <div class="div_any_child div_height">
                <div class="div_any_title"><img src="{% static 'MainInformation/images/title_1.png' %}">监控视频</div>

                <div class="empty-row"></div>
                <div class="button-container">
                    <button id="video1" onclick="changeVideo('video1')" class="blue-button active">监控1</button>
                    <button id="video2" onclick="changeVideo('video2')" class="blue-button">监控2</button>
                    <button id="video3" onclick="changeVideo('video3')" class="blue-button">监控3</button>
                    <button id="video4" onclick="changeVideo('video4')" class="blue-button">监控4</button>
                </div>
                
                <div class="video-container">
                    <video id="video1" src="{% static 'MainInformation/videos/video1.mp4' %}" loop muted></video>
                    <video id="video2" src="{% static 'MainInformation/videos/video2.mp4' %}" loop muted></video>
                    <video id="video3" src="{% static 'MainInformation/videos/video3.mp4' %}" loop muted></video>
                    <video id="video4" src="{% static 'MainInformation/videos/video4.mp4' %}" loop muted></video>
                </div>


                <div class="table-container">
                    <div class="table_p" style="height: 85%;margin-top: 0%;">
                        <table>
                            <thead><tr>
                                <th style="font-size: 15;">导入数据工作台</th>
                            </tr>
                            </thead>
                            <tbody>
    
                            <tr>
                                <td>
                                    <div class="button-container">
                                        {% csrf_token %}
                                        <input id="upload" type="file" style="width: 50%" name="file" id="filename" >
                                        <button class="blue-button active" type="button" onclick="Upload()">导入历史水文数据</button>
                                    </div> 
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                
            </div>





        </div>
        <div class="left div_any05">
            <div class="div_any_child">
                <div class="div_any_title"><img src="{% static 'MainInformation/images/title_1.png' %}">水文气象</div>
                <div id="histogramChart0" style="width: 90%; height: 100%;margin-left: auto;margin-right: auto;margin-top:5%"></div>
                
            </div>
            <div class="div_any_child">
                <div class="div_any_title"><img src="{% static 'MainInformation/images/title_2.png' %}">定位</div>
                <div class="empty-row"></div>
                <div class="empty-row"></div>
                <div id="wrapper"></div>
                <style>
                    #wrapper{
                        width: 85%;
                        height: 75%;
                        margin-left: auto;
                        margin-right: auto;
                        display: block;
                        text-align: center;
                        border: 1px solid #034c6a;
                        box-sizing: border-box;
                    }
                </style>

                
                <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.8&key=ab69b13db701db1bfd29d1cbd258da40"></script> 
                

                <script>
                    //初始化地图插件
                    window.onload = function(){
                        var map = new AMap.Map('wrapper', {
                            zoom: 17,
                            dragEnable: false, // 禁用拖拽功能
                            zoomEnable: false, // 禁用缩放功能
                            center: [117.17325638567854, 39.103630700102] // 新开湖
                        });
                        var satelliteLayer = new AMap.TileLayer.Satellite({
                            zIndex: 9
                        });
                        map.add(satelliteLayer);//添加图层到地图
                    }
                </script>

            </div>
        </div>
        <div class="right div_any05">
            <div class="div_any_child">
                <div class="div_any_title"><img src="{% static 'MainInformation/images/title_3.png' %}">历史记录</div>
                
            </div>
            <div class="div_any_child">
                <div class="div_any_title"><img src="{% static 'MainInformation/images/title_4.png' %}">设备状态</div>
                <div class="empty-row"></div>
                <div class="button-container">
                    <button  class="blue-button active">主控</button>
                    <button  class="blue-button">时间校准</button>
                    <button  class="blue-button">通道</button>
                    <button  class="blue-button">告警</button>
                </div>
            </div>
        </div>
    </div>
    


</div>



</body>



<script>
// 定义颜色数组
var myColor = ['#1089E7', '#F57474', '#56D0E3', '#F8B448', '#8B78F6'];

// 初始化图表
var histogramChart0 = echarts.init(document.getElementById('histogramChart0'));

// 定义从数据库获取数据的函数
function fetchDataFromDatabase(water) {
    
    return {
        yAxisData: ['水温(℃)', 'pH', '溶解氧(mg/L)', '电导率(μS/cm)', '浊度(NTU)', '高锰酸盐(mg/L)','氨氮(mg/L)','总磷(mg/L)','总氮(mg/L)'],
        seriesData1: water,
        seriesData2: [17,7.36,9.89,250,53.5,6.41,0.29,0.12,2.02]
    };
}

// 获取数据并设置图表选项
var water_list = [
        "{{today_water.temperature}}",
        "{{today_water.ph}}",
        "{{today_water.dissolved_oxygen}}",
        "{{today_water.conductivity}}",
        "{{today_water.turbidity}}",
        "{{today_water.permanganate_index}}",
        "{{today_water.ammonia_nitrogen}}",
        "{{today_water.total_phosphorus}}",
        "{{today_water.total_nitrogen}}"
    ];
var data = fetchDataFromDatabase(water_list);
histogramChart0.setOption({
    grid: {
        top: '10%',
        left: '40%',
        right: '20%',
    },
    xAxis: {
        show: false
    },
    yAxis: [{
        show: true,
        data: data.yAxisData,
        inverse: true,
        axisLine: {
            show: false
        },
        splitLine: {
            show: false
        },
        axisTick: {
            show: false
        },
        axisLabel: {
            color: '#fff',
            formatter: (value, index) => {
                return [
                    `{lg|${index + 1}}  ` + '{title|' + value + '} '
                ].join('\n')
            },
            rich: {
                lg: {
                    backgroundColor: '#339911',
                    color: '#fff',
                    borderRadius: 15,
                    align: 'center',
                    width: 15,
                    height: 15
                },
            }
        },
    }, {
        show: true,
        inverse: true,
        data:data.seriesData1,
        axisLabel: {
            textStyle: {
                fontSize: 12,
                color: '#fff',
            },
        },
        axisLine: {
            show: false
        },
        splitLine: {
            show: false
        },
        axisTick: {
            show: false
        },
    }],
    series: [{
        name: '条',
        type: 'bar',
        yAxisIndex: 0,
        data: data.seriesData1.map((value, index) => value / data.seriesData2[index]),
        barWidth: 10,
        itemStyle: {
            normal: {
                barBorderRadius: 20,
                color: function(params) {
                    var num = myColor.length;
                    return myColor[params.dataIndex % num]
                },
            }
        },
        label: {
            normal: {
                show: false, // 隐藏柱子上的标签
                position: 'inside',
                formatter: '{c}%',
                fontSize: 12,
            }
        },
    }, {
        name: '框',
        type: 'bar',
        yAxisIndex: 1,
        barGap: '-100%',
        data: data.seriesData2.map((value, index) => value / data.seriesData2[index]),
        barWidth: 15,
        itemStyle: {
            normal: {
                color: 'none',
                borderColor: '#00c1de',
                borderWidth: 3,
                barBorderRadius: 15,
            }
        }
    }, ]
});




function Upload() {
            var fileInput = document.getElementById('upload').files[0];
            if (fileInput) {
                var formData = new FormData();
                formData.append('file', fileInput);
                fetch('./upload', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'), // 获取CSRF token
                    },
                })
                .then(data => {
                    console.log('Success:', data);
                    // 在这里添加页面刷新的代码
                    location.reload(); 
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else {
                alert("请选择上传文件！");
            }
        }

        // 用于获取CSRF token的辅助函数
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // 获取名为 name 的 cookie 值
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }














</script>










</html>
